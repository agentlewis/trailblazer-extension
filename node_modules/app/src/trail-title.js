/** @jsx React.DOM */
var React = require('react');

module.exports = React.createClass({
  getInitialState: function () {
    //NOTE: possible antipattern of props in state
    return {
      editable: false,
      tempValue: this.props.title
    };
  },

  render: function () {
    var editable = this.state.editable;

    if (editable) {
      return <div> 
                <input 
                type="text" 
                value={this.state.tempValue}
                onChange={this.handleChange}
                onBlur={this.handleBlur} />
                <img src="/ui/icons/editable-icon.svg" />
              </div>
    } else {
      return  <h1>
                <a href="#">
                  {this.state.tempValue}
                  <img
                    onClick={this.handleIconClick} 
                    src="/ui/icons/editable-icon.svg" />
                </a>
              </h1>;
    };
  },

  handleIconClick: function () {
    this.setState({editable: true})
  },

  handleChange: function (evt) {
    this.setState({tempValue: evt.target.value})
  },

  handleBlur: function (evt) {
    this.setState({editable: false});
    chrome.runtime.sendMessage({
      action: 'updateAssignment', 
      assignmentId: this.props.id, 
      props: {title: this.state.tempValue}
    });
  }
});
